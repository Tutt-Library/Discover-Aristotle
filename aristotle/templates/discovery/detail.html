{% extends 'discovery/base.html' %}
{% set source = info['_source'] %}

{% block head_title %}Library Search &#8226; {{ source.get('titlePrincipal') }}{% endblock %}

{% block more_css %}
 
{% endblock %}

{% block library_breadcrumb %}
 <div id="breadcrumb"></div>
{% endblock %}

{% block container %}
<div class="container">
		{% include "discovery/search-panel-row.html" %}
		<div class="row" style="margin-top: 3em;">
				<ol class="breadcrumb">
						{% for row in source.get('inCollections') %}
						<li {% if loop.last %}class="active"{% endif %}>
						<a href="{{ url_for('fedora_object', identifier='pid', value=row) }}">
								{{ row|title_principal|truncate(30, True) }}</a>
						</li>
                        {% endfor %}
                </ol>
				
				<h1>{{ source.get('titlePrincipal') }}</h1>
				{% if 'creator' in source %}
				<h3>by 
				{% for creator in source.get('creator', []) %}
				{{ creator }}{% if not loop.last %},{% endif %}
				{% endfor %}
		        </h3>
				{% endif %}
				{# include 'discovery/snippets/datastream-carousel.html' #}
				<section class="col-md-6">
				<img src="{{ url_for('fedora_object', value=source.get('pid'), identifier="thumbnail") }}"
				 {# style="width: 30%"  class="pull-left" #}>
				 <br>
				 <div class="btn-group" role="group">
						 {% for datastream in source.get('datastreams') %}	 
						 <a data-toggle="modal" href="#" data-target="#dialog-{{ loop.index }}" class="btn btn-default btn-lg">
								 <i class="glyphicon {{ datastream|icon }}"></i> 
						 </a>
						 {% endfor %}
				 </div>
				 <br>
				 <br>
				 <div>
					
					<h5>Media Files</h5>
					<ul> {% for datastream in source.get('datastreams') %} 
						<li> 
						 <a data-toggle="modal" href="#" data-target="#dialog-{{ loop.index }}">
								 {{datastream.get('label')}}
								 <i class="glyphicon {{ datastream|icon }}"></i>
						 </a>
						 </li>	
							{% endfor %}
					</ul>
				 </div>			
				 </section>
				<section class="col-md-6">
				
				<div class="panel-group" id="metadataaccordion" role="tablist" aria-multiselectable="true">


  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingBasic">
      <h3 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#metadataaccordion" href="#collapseBasic" aria-expanded="true" aria-controls="collapseBasic">
          Basic Information
        </a>
      </h3>
    </div>
    <div id="collapseBasic" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingBasic">
			<div class="panel-body">

			 {% if 'creator' in source %}
						<h5>Creator</h5>
				{% for creator in source.get('creator', []) %}
				{{ creator }}{% if not loop.last %},{% endif %}
				{% endfor %}
				{% endif %}
				<h5>Date Created</h5>
				{{ source.get('dateCreated') }}
				<h5>Place</h5>
				{{ source.get('place') }}
				<h5>Language{% if source.get('language', [])|length > 1%}s{% endif %}</h5>
				<ul>
				{% for lang in  source.get('language', []) %}
				<li>{{ lang }}</li>
				{% endfor %}
		        </ul>
				<h5>Subject</h5>
				{% for subject, info in source.get('subject').items() %}
				  {% if info[0] %}
				  <strong>{{ subject }}</strong>
                  <ul>
				  {% for row in info %}
				  <li>{{ row }}</li>
				  {% endfor %}
		          </ul>
				  {% endif %}	
				{% endfor %}
				<h5>Genre</h5>
				<ul>
				{% for genre in  source.get('genre') %}
                <li>{{ genre }}</li>
				{% endfor %}
		        </ul>


      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h3 class="panel-title">
        <a role="button" data-toggle="collapse" data-parent="#metadataaccordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          Abstract and Notes
        </a>
      </h3>
    </div>
    <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
        <h5>Abstract</h5>
		    {% for abstract in source.get("abstract", [])%}
			<p>{{ abstract|safe }}</p>
			{% endfor %}
		<h5>Note</h5>
			{% for note in source.get("note")%}
			<p>{{ note|safe }}</p>
			{% endfor %}
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingTwo">
      <h3 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#metadataaccordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          Technical Metadata
        </a>
      </h3>
    </div>
    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
      <div class="panel-body">
        <h5>Administrative Notes</h5>
		    {% for adminNote in source.get("adminNote",[])%}
			<p>{{ adminNote|safe }}</p>
			{% endfor %}
		<h5>Copyright</h5>
			{{ source.get('useAndReproduction') }}
		<h5>Publisher</h5>
			{{ source.get('publisher') }}
		<h5>PID</h5>
			{{ source.get('pid') }}	
		<h5>Handle</h5>
  		<a href="{{ source.get('handle') }}">{{ source.get('handle') }}</a>
		<h5>Digital Origin</h5>
			{{ source.get('digitalOrigin') }}
		<h5>Extent</h5>
			{{ source.get('extent') }}
      </div>
    </div>
	</div>
	{%if 'thesis' in source%}
	<div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingThree">
      <h3 class="panel-title">
        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#metadataaccordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          Thesis
        </a>
      </h3>
    </div>
    <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
      <div class="panel-body">
		<h5>Thesis</h5>
			{% for thesis in source.get("thesis")%}
			{{ thesis|safe }}
			{% endfor %}
		<h5>Thesis Advisor</h5>
			{% for thesisAdvisor in source.get("thesisAdvisor")%}
			{{ thesisAdvisor|safe}}
			{% endfor %}
        {% if "sponsor" in source %}
		<h5>Department/Program</h5>
			{% for sponsor in source.get("sponsor")%}
			{{ sponsor|safe}}
			{% endfor %}
        {% endif %}
		<h5>Degree Name</h5>
			{% for degreeName in source.get("degreeName")%}
			{{ degreeName|safe}}
			{% endfor %}	
		<h5>Degree Type</h5>
			{% for degreeType in source.get("degreeType")%}
			{{ degreeType|safe}}
			{% endfor %}
        {% if "degreeGrantor" in source %}
		<h5>Degree Grantor</h5>
			{% for degreeGrantor in source.get("degreeGrantor")%}
			{{ degreeGrantor|safe}}
			{% endfor %}
        {% endif %}
		<h5>Date Issued</h5>
			{{ source.get('dateIssued') }}
      </div>
    </div>
  </div>
  	{% endif %}
</div>  
				 </section>

		 </div>
 </div>
 {% endblock %}

 {% block dialogs %}
 {% for datastream in source.get('datastreams') %}
 <div class="modal fade" tabindex="-1" role="dialog" id="dialog-{{ loop.index }}">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<h4 class="modal-title">{{ source.get('titlePrincipal') }} {{ datastream.label }}</h4>
      </div>
	  <div class="modal-body">
			  {{ datastream|viewer|safe }}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
 </div><!-- /.modal -->
{% endfor %}
 
{% endblock %}

{% block more_scripts %}
<script>
 var detailViewModel = function() {
   var self = this;
   self.chosenSearch = ko.observable();
   self.searchingOptions =  [
      { name: "Keyword", search_type: "search" },
      { name: "Author", search_type: "author_search" },
      { name: "Title", search_type: "title_search" },
      { name: "Subject", search_type: "subject_search" },
      { name: "Number", search_type: "number_search" }
    ];
   self.searchQuery = ko.observable();
   self.searchCatalog = function() {
     var query = self.searchQuery();
     if(query) {
        var url = "{{ url_for('index') }}?q=" + query +"&mode=" + self.chosenSearch()["search_type"];
        console.log(url);
        window.location=url; 
     }
   }
   self.searchRouting = function() {}
 }
 var viewModel = new detailViewModel();
 ko.applyBindings(viewModel);

</script>
{% endblock %}
